<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wealth Command</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />

  <!-- App Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Favicon (optional) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2216%22>ðŸ’°</text></svg>">
</head>
<body>

  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg bg-white sticky-top">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="#">
        <i class="bi bi-cash-coin text-primary"></i> Wealth Command
      </a>

      <div class="ms-auto d-flex align-items-center gap-3">
        <!-- Signed-in user text -->
        <div id="signedInUser" class="small text-muted d-none">
          <span id="userEmail">Connected</span>
        </div>

        <!-- Status icon stack (replaces toasts) -->
        <div id="statusIconStack" class="status-icon-stack" aria-live="polite"></div>

        <!-- Profile / Auth actions -->
        <div class="d-flex align-items-center gap-2">
          <span id="profilePicture"><i class="bi bi-person-circle profile-icon"></i></span>

          <!-- Sign in / out actions -->
          <button id="signInOption" class="btn btn-sm btn-outline-primary" onclick="showGoogleSignIn()">
            <i class="bi bi-google"></i> Sign in
          </button>
          <button id="signOutOption" class="btn btn-sm btn-outline-secondary d-none" onclick="googleSignOut()">
            <i class="bi bi-box-arrow-right"></i> Sign out
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container main-content pt-3">

    <!-- DASHBOARD TAB -->
    <section id="tab-dashboard" class="tab-page">
      <div class="row g-3 mb-3">
        <div class="col-12 col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <h6 class="card-title mb-2">Net Wealth (<span id="currencyLabel">PKR</span>)</h6>
              </div>
              <div id="netWealth" class="display-6 fw-bold">0</div>
              <div class="text-muted small mt-1">
                <span id="syncStatusText">Sign in to sync with Google Drive</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <h6 class="card-title mb-2">Total Income</h6>
              <div id="totalIncome" class="h4 text-success mb-0">0</div>
            </div>
          </div>
        </div>

        <div class="col-6 col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <h6 class="card-title mb-2">Total Expense</h6>
              <div id="totalExpense" class="h4 text-danger mb-0">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters + Rollover -->
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <div class="card mb-3">
            <div class="card-body">
              <div class="row g-2 align-items-center">
                <div class="col-6 col-md-4">
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                    <select id="summaryMonth" class="form-select"></select>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    <select id="summaryYear" class="form-select"></select>
                  </div>
                </div>
                <div class="col-12 col-md">
                  <div id="rolloverBalance" class="rollover-balance d-none">
                    <div class="d-flex justify-content-between">
                      <div>
                        <div class="small text-muted" id="rolloverDescription">Carried over</div>
                        <div class="rollover-amount" id="rolloverAmount">+0 PKR</div>
                      </div>
                      <div>
                        <button class="btn btn-sm btn-outline-secondary" onclick="toggleRolloverSettings()">
                          Adjust
                        </button>
                      </div>
                    </div>
                  </div>
                  <!-- Hidden controls exist in Settings; Adjust button here opens prompt -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Income / Expense Breakdown -->
        <div class="col-12">
          <div class="breakdown-container">
            <div class="breakdown-card income-card card">
              <h6 class="card-header-enhanced">Income Breakdown</h6>
              <div id="incomeBreakdown" class="breakdown-list"></div>
              <div id="noIncomeCategories" class="text-center text-muted py-3">No income categories</div>
            </div>

            <div class="breakdown-card expense-card card">
              <h6 class="card-header-enhanced">Expense Breakdown</h6>
              <div id="expenseBreakdown" class="breakdown-list"></div>
              <div id="noExpenseCategories" class="text-center text-muted py-3">No expense categories</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TRANSACTIONS TAB -->
    <section id="tab-transactions" class="tab-page d-none">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="card-title mb-0">Transactions</h6>
            <div class="d-flex gap-2">
              <button id="openAddTransactionModal" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Transaction
              </button>
              <button id="exportBtn" class="btn btn-outline-secondary">
                <i class="bi bi-download"></i> Export JSON
              </button>
              <button id="importBtn" class="btn btn-outline-secondary">
                <i class="bi bi-upload"></i> Import JSON
              </button>
              <input id="importFile" type="file" accept="application/json" class="d-none" />
            </div>
          </div>

          <div class="table-container">
            <div class="table-responsive-container">
              <table id="transactionsTable" class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="transactionsBody"></tbody>
              </table>
            </div>
          </div>

          <div id="noTransactions" class="text-center text-muted py-3">No transactions yet.</div>
        </div>
      </div>
    </section>

    <!-- CHARTS TAB -->
    <section id="tab-charts" class="tab-page d-none">
      <div class="card chart-card mb-3">
        <div class="chart-controls">
          <div class="chart-header-row w-100">
            <div class="chart-filters">
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                <select id="chartMonth" class="form-select"></select>
              </div>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                <select id="chartYear" class="form-select"></select>
              </div>
            </div>

            <div class="chart-type-buttons">
              <button class="btn btn-outline-primary active" data-chart-type="category">
                <i class="bi bi-columns-gap"></i> Category
              </button>
              <button class="btn btn-outline-primary" data-chart-type="monthly">
                <i class="bi bi-graph-up"></i> Monthly Trend
              </button>
              <button class="btn btn-outline-primary" data-chart-type="yearly">
                <i class="bi bi-graph-up-arrow"></i> Yearly Trend
              </button>
            </div>
          </div>

          <div id="chartSummaryStats" class="chart-summary-stats"></div>
        </div>

        <div class="chart-body">
          <div id="chartPlaceholder" class="chart-placeholder">Select a chart type to view data visualization</div>
          <canvas id="mainChart" height="300"></canvas>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <div class="distribution-card income card">
            <div class="card-header">Income Distribution</div>
            <div class="chart-body">
              <div id="incomePiePlaceholder" class="chart-placeholder">No income data available</div>
              <canvas id="incomePieChart" height="250"></canvas>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="distribution-card expense card">
            <div class="card-header">Expense Distribution</div>
            <div class="chart-body">
              <div id="expensePiePlaceholder" class="chart-placeholder">No expense data available</div>
              <canvas id="expensePieChart" height="250"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS TAB -->
    <section id="tab-settings" class="tab-page d-none">
      <!-- Cloud Sync -->
      <div class="card mb-3">
        <div class="card-header fw-bold">Cloud Sync</div>
        <div class="card-body d-flex flex-wrap align-items-center gap-2">
          <button id="manualSyncSettings" class="btn btn-outline-primary">
            <i class="bi bi-cloud-arrow-up"></i> Sync Now
          </button>
          <span class="text-muted small">Sign in to sync across devices</span>
        </div>
      </div>

      <!-- Monthly Rollover Settings -->
      <div class="card mb-3">
        <div class="card-header fw-bold">Monthly Rollover Settings</div>
        <div class="card-body">
          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="autoRolloverToggle" />
            <label class="form-check-label" for="autoRolloverToggle">Auto-rollover balances</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="allowNegativeRollover" />
            <label class="form-check-label" for="allowNegativeRollover">Allow negative rollovers</label>
          </div>
        </div>
      </div>

      <!-- Appearance -->
      <div class="card mb-3">
        <div class="card-header fw-bold">Appearance</div>
        <div class="card-body">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="darkModeSwitch" />
            <label class="form-check-label" for="darkModeSwitch">Enable dark mode</label>
          </div>
        </div>
      </div>

      <!-- Currency -->
      <div class="card mb-3">
        <div class="card-header fw-bold">Currency</div>
        <div class="card-body">
          <select id="currencySelect" class="form-select" style="max-width: 220px;">
            <option value="PKR">PKR - Pakistani Rupee</option>
            <option value="USD">USD - US Dollar</option>
            <option value="EUR">EUR - Euro</option>
          </select>
        </div>
      </div>

      <!-- Category Settings -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">Category Settings</span>
          <button id="toggleCategorySettings" class="btn btn-sm btn-outline-secondary">
            <span id="catCollapseIcon"><i class="bi bi-chevron-down"></i></span>
          </button>
        </div>
        <div id="categorySettingsPanel" class="card-body">
          <div class="row g-2 align-items-end">
            <div class="col-12 col-md-6">
              <label class="form-label">Category name</label>
              <input id="newCategoryInput" type="text" class="form-control" placeholder="e.g., Rent" />
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Type</label>
              <select id="newCategoryType" class="form-select">
                <option value="income">Income</option>
                <option value="expense" selected>Expense</option>
              </select>
            </div>
            <div class="col-6 col-md-3">
              <button id="addCategoryBtn" class="btn btn-primary w-100">
                <i class="bi bi-plus-circle"></i> Add
              </button>
            </div>
          </div>

          <hr class="my-3" />
          <ul id="categoryList" class="list-group"></ul>
        </div>
      </div>

      <!-- PDF Export -->
      <div class="card mb-5">
        <div class="card-header fw-bold">Export as PDF</div>
        <div class="card-body d-flex flex-wrap gap-2">
          <button class="btn btn-outline-primary" id="exportPdfDashboardBtn">
            <i class="bi bi-filetype-pdf"></i> Dashboard
          </button>
          <button class="btn btn-outline-primary" id="exportPdfTransactionsBtn">
            <i class="bi bi-filetype-pdf"></i> Transactions
          </button>
          <button class="btn btn-outline-primary" id="exportPdfChartsBtn">
            <i class="bi bi-filetype-pdf"></i> Charts
          </button>
          <button class="btn btn-primary" id="exportPdfAllBtn">
            <i class="bi bi-filetype-pdf"></i> Export All
          </button>
        </div>
      </div>
    </section>

  </main>

  <!-- Fixed Bottom Navigation -->
  <div id="fixedNavBar" class="w-100">
    <div class="container d-flex">
      <button class="nav-btn active flex-fill" data-tab="dashboard">
        <i class="bi bi-speedometer2"></i>
        <small>Dashboard</small>
      </button>
      <button class="nav-btn flex-fill" data-tab="transactions">
        <i class="bi bi-list-task"></i>
        <small>Transactions</small>
      </button>
      <button class="nav-btn flex-fill" data-tab="charts">
        <i class="bi bi-pie-chart"></i>
        <small>Charts</small>
      </button>
      <button class="nav-btn flex-fill" data-tab="settings">
        <i class="bi bi-gear"></i>
        <small>Settings</small>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-4">
    <div class="container text-center text-muted small">
      &copy; <span id="yearCopy"></span> Wealth Command
    </div>
  </footer>

  <!-- Modals -->

  <!-- Add / Edit Transaction -->
  <div class="modal fade" id="addTransactionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="transactionForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addTransactionModalLabel"><i class="bi bi-plus-circle"></i> Add Transaction</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editTransactionIndex" value="-1" />

          <div class="mb-2">
            <label class="form-label">Date</label>
            <input id="dateInput" type="date" class="form-control" required />
          </div>

          <div class="mb-2">
            <label class="form-label">Description</label>
            <input id="descInput" type="text" class="form-control" placeholder="e.g., Grocery" required />
          </div>

          <div class="row g-2">
            <div class="col-6">
              <label class="form-label">Type</label>
              <select id="typeInput" class="form-select" required>
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label">Category</label>
              <select id="categoryInput" class="form-select" required></select>
            </div>
          </div>

          <div class="mt-2">
            <label class="form-label">Amount</label>
            <input id="amountInput" type="number" step="0.01" class="form-control" required />
          </div>

          <div id="formAlert" class="alert alert-danger d-none mt-3"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <span id="submitButtonText">Add</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Category Transactions Modal -->
  <div class="modal fade category-transactions-modal" id="categoryTransactionsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="categoryTransactionsTitle" class="modal-title"><i class="bi bi-list-ul"></i> Category Transactions</h5>
          <button type="button" class="btn btn-sm btn-primary" onclick="addTransactionForCategory()">
            <i class="bi bi-plus-circle"></i> Add
          </button>
          <button type="button" class="btn-close ms-2" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div id="categoryTransactionsInfo" class="text-muted small">Showing 0 transactions</div>
            <div id="categoryTotalAmount" class="fw-bold"></div>
          </div>
          <div id="noCategoryTransactions" class="text-center text-muted py-3 d-none">
            No transactions found for this category in the selected period.
          </div>
          <div id="categoryTransactionsList" class="category-transactions-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Action Modal -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="confirmationTitle" class="modal-title">Confirm Action</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div id="confirmationMessage" class="modal-body">
          Are you sure?
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="confirmActionBtn" class="btn btn-danger">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

  <!-- App Script -->
  <script src="app.js"></script>

  <script>
    // Footer year
    document.getElementById('yearCopy').textContent = new Date().getFullYear();
  </script>
</body>
</html>
