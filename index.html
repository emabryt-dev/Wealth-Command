<!DOCTYPE html>
<html lang="en">
html
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Command Pro</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme colors -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Wealth Command">
    
    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💰</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💰</text></svg>">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f8fafc; 
            min-height: 100vh;
            color: #1f2937;
        }
        
        /* Header */
        .header { 
            background: white; 
            padding: 1rem; 
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Cards */
        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 1.25rem; 
            margin: 1rem; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #f1f5f9;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            padding: 0.5rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-btn {
            flex: 1;
            padding: 0.75rem 0.5rem;
            border: none;
            background: none;
            font-size: 0.75rem;
            color: #6b7280;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .nav-btn.active {
            color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
        }
        
        .nav-btn i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            display: block;
        }
        
        /* Tabs */
        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Buttons */
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        
        /* Utility classes */
        .text-green { color: #10b981; }
        .text-red { color: #ef4444; }
        .text-blue { color: #3b82f6; }
        .text-lg { font-size: 1.25rem; }
        .text-xl { font-size: 1.5rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .grid { display: grid; }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        
        /* Inputs */
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Main content area */
        .main-content {
            padding-bottom: 100px;
            min-height: calc(100vh - 140px);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        /* Transaction items */
        .transaction-item {
            padding: 1rem;
            border: 1px solid #f1f5f9;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        
        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="flex justify-between items-center">
            <div>
                <h1 style="font-size: 1.5rem; font-weight: 700; background: linear-gradient(45deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    💰 Wealth Command
                </h1>
                <div id="currentMonthDisplay" style="color: #6b7280; font-size: 0.875rem;">Loading...</div>
            </div>
            <div style="text-align: right;">
                <div id="headerBalance" class="text-xl font-bold">Rs 0</div>
                <div style="color: #6b7280; font-size: 0.75rem;">Current Balance</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab active">
            <!-- Month Selector & Add Button -->
            <div class="card">
                <div class="flex gap-3">
                    <select id="monthSelect" class="flex-1">
                        <option value="">Loading months...</option>
                    </select>
                    <button id="addTransactionBtn" class="btn">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="card">
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-3">
                        <div id="totalIncome" class="text-green text-xl font-bold">Rs 0</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Income</div>
                    </div>
                    <div class="text-center p-3">
                        <div id="totalExpenses" class="text-red text-xl font-bold">Rs 0</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Expenses</div>
                    </div>
                    <div class="text-center p-3">
                        <div id="netAmount" class="text-blue text-xl font-bold">Rs 0</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Savings</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="switchTab('transactions')" class="p-3 text-center" style="border: 2px solid #e5e7eb; border-radius: 10px; transition: all 0.3s ease;">
                        <i class="fas fa-exchange-alt text-blue" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <div class="font-semibold">Transactions</div>
                    </button>
                    <button onclick="switchTab('analytics')" class="p-3 text-center" style="border: 2px solid #e5e7eb; border-radius: 10px; transition: all 0.3s ease;">
                        <i class="fas fa-chart-bar text-green" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <div class="font-semibold">Analytics</div>
                    </button>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold">Recent Transactions</h3>
                    <span style="color: #6b7280; font-size: 0.875rem;">This Month</span>
                </div>
                <div id="recentTransactionsList" class="space-y-3">
                    <div style="text-align: center; color: #6b7280; padding: 2rem;">
                        <i class="fas fa-receipt" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <div>No transactions yet</div>
                    </div>
                </div>
            </div>

            <!-- Category Progress -->
            <div class="card">
                <h3 class="font-semibold mb-4">Category Progress</h3>
                <div id="categoryProgress" class="space-y-4">
                    <div style="text-align: center; color: #6b7280; padding: 1rem;">
                        Start adding expenses to see progress
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-semibold">All Transactions</h2>
                    <button onclick="showTransactionModal()" class="btn" style="padding: 0.5rem 0.75rem;">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <input type="text" id="searchTransactions" placeholder="🔍 Search transactions..." 
                       class="mb-4">
                
                <div id="transactionsList" class="space-y-3">
                    <div style="text-align: center; color: #6b7280; padding: 3rem;">
                        <i class="fas fa-exchange-alt" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <div>No transactions found</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-semibold">Financial Insights</h2>
                    <select id="analyticsRange">
                        <option value="3">3 Months</option>
                        <option value="6">6 Months</option>
                        <option value="12">12 Months</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 gap-3 mb-4">
                    <div style="background: linear-gradient(45deg, #10b981, #059669); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div class="text-xl font-bold" id="avgIncome">Rs 0</div>
                        <div style="opacity: 0.9;">Avg Monthly Income</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #ef4444, #dc2626); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div class="text-xl font-bold" id="avgExpenses">Rs 0</div>
                        <div style="opacity: 0.9;">Avg Monthly Expenses</div>
                    </div>
                    <div style="background: linear-gradient(45deg, #3b82f6, #2563eb); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div class="text-xl font-bold" id="avgSavings">Rs 0</div>
                        <div style="opacity: 0.9;">Avg Monthly Savings</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="font-semibold mb-4">Monthly Breakdown</h3>
                <div id="monthlyBreakdown" class="space-y-3">
                    <div style="text-align: center; color: #6b7280; padding: 2rem;">
                        Analytics will appear here
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab">
            <div class="card">
                <h2 class="font-semibold mb-4">Categories</h2>
                
                <button onclick="showAddCategoryModal()" class="btn btn-success w-full mb-4">
                    <i class="fas fa-plus"></i> Add New Category
                </button>
                
                <div id="categoriesList" class="space-y-3">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <div class="card">
                <h3 class="font-semibold mb-4">Data Management</h3>
                <div class="space-y-3">
                    <button onclick="exportData()" class="btn w-full">
                        <i class="fas fa-download"></i> Export Data (CSV)
                    </button>
                    <button onclick="backupData()" class="btn btn-success w-full">
                        <i class="fas fa-save"></i> Backup Data (JSON)
                    </button>
                    <button onclick="resetAllData()" class="btn btn-danger w-full">
                        <i class="fas fa-trash"></i> Reset All Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="switchTab('dashboard')">
            <i class="fas fa-chart-pie"></i>
            <div>Dashboard</div>
        </button>
        <button class="nav-btn" onclick="switchTab('transactions')">
            <i class="fas fa-exchange-alt"></i>
            <div>Transactions</div>
        </button>
        <button class="nav-btn" onclick="switchTab('analytics')">
            <i class="fas fa-chart-bar"></i>
            <div>Analytics</div>
        </button>
        <button class="nav-btn" onclick="switchTab('settings')">
            <i class="fas fa-cog"></i>
            <div>Settings</div>
        </button>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-semibold">Add Transaction</h3>
                <button onclick="closeModal()" style="padding: 0.5rem; color: #6b7280; border: none; background: none; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Date</label>
    <input type="date" id="transDate">
</div>
<div>
    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description</label>
    <input type="text" id="transDesc" placeholder="What was this for?">
</div>
<div>
    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Type</label>
    <div class="grid grid-cols-2 gap-3">
        <button id="incomeTypeBtn" class="btn btn-success">Income</button>
        <button id="expenseTypeBtn" class="btn btn-danger">Expense</button>
    </div>
</div>
<div>
    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Category</label>
    <select id="transCategory">
        <option value="">Select a type first</option>
    </select>
</div>
<div>
    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Amount (Rs)</label>
    <input type="text" id="transAmount" placeholder="0" oninput="formatAmount(this)">
</div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mt-6">
                <button onclick="closeModal()" style="padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 10px; background: white;">Cancel</button>
                <button id="saveTransactionBtn" class="btn">Save Transaction</button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-semibold">Add Category</h3>
                <button onclick="closeCategoryModal()" style="padding: 0.5rem; color: #6b7280; border: none; background: none; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
    <label for="newCategoryName" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Category Name</label>
    <input type="text" id="newCategoryName" placeholder="e.g., Groceries, Rent, etc.">
</div>
<div>
    <label for="newCategoryBudget" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Monthly Budget (Rs)</label>
    <input type="text" id="newCategoryBudget" placeholder="0" oninput="formatAmount(this)">
</div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mt-6">
                <button onclick="closeCategoryModal()" style="padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 10px; background: white;">Cancel</button>
                <button onclick="saveNewCategory()" class="btn btn-success">Save Category</button>
            </div>
        </div>
    </div>

   <script>
    // ===== WEALTH COMMAND PRO - COMPLETE JAVASCRIPT =====
    
    // Enhanced categories with your specific list
    const defaultCategories = [
        'Paycheck', 'Savings', 'Loan Returned', 'Loan Given', 'Committee Taken',
        'Food', 'Gifts', 'Mobile Balance', 'Home', 'Fuel', 'Personal',
        'Committee Given', 'Utilities', 'Debt Payment', 'Other', 'Bike Installment',
        'Bike Maintenance', 'Charity', 'Netflix', 'Loan Taken', 'Others'
    ];

    // App state
    let transactions = JSON.parse(localStorage.getItem('financeTransactions')) || [];
    let categories = JSON.parse(localStorage.getItem('categories')) || 
        defaultCategories.map(name => ({ name, budget: 10000 }));
    let currentMonth = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
    let currentTransactionType = '';

    // Utility functions
    function formatCurrency(amount) {
        return 'Rs ' + parseInt(amount).toLocaleString('en-PK');
    }

    function parseCurrency(amountStr) {
        return parseInt(amountStr.replace(/[^0-9]/g, '')) || 0;
    }

    function formatAmount(input) {
        let value = input.value.replace(/[^0-9]/g, '');
        if (value) {
            value = parseInt(value).toLocaleString('en-PK');
        }
        input.value = value;
    }

    function updateHeaderBalance() {
        const totalIncome = transactions.filter(t => t.type === 'income')
            .reduce((sum, t) => sum + parseCurrency(t.amount), 0);
        
        const totalExpenses = transactions.filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + parseCurrency(t.amount), 0);
        
        const balance = totalIncome - totalExpenses;
        document.getElementById('headerBalance').textContent = formatCurrency(balance);
    }

    // Navigation
    function switchTab(tabName) {
        // Update bottom nav
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const activeBtn = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
        if (activeBtn) activeBtn.classList.add('active');

        // Update content
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');

        // Refresh tab content
        if (tabName === 'dashboard') refreshDashboard();
        else if (tabName === 'transactions') renderTransactionsList();
        else if (tabName === 'analytics') refreshAnalytics();
        else if (tabName === 'settings') renderSettings();
    }

    // Dashboard functions
    function refreshDashboard() {
        populateMonthSelect();
        updateSummaryCards();
        renderRecentTransactions();
        renderCategoryProgress();
        updateHeaderBalance();
    }

    function populateMonthSelect() {
        const select = document.getElementById('monthSelect');
        select.innerHTML = '';
        
        const months = [...new Set(transactions.map(t => 
            new Date(t.date).toLocaleString('default', { month: 'long', year: 'numeric' })
        ))].sort((a, b) => new Date('1 ' + a) - new Date('1 ' + b));
        
        // Add current month if no transactions yet
        if (months.length === 0) {
            months.push(currentMonth);
        }
        
        months.forEach(month => {
            const option = document.createElement('option');
            option.value = month;
            option.textContent = month;
            select.appendChild(option);
        });
        
        if (months.length > 0) {
            select.value = currentMonth;
            document.getElementById('currentMonthDisplay').textContent = currentMonth;
        }
        
        select.onchange = (e) => {
            currentMonth = e.target.value;
            document.getElementById('currentMonthDisplay').textContent = currentMonth;
            refreshDashboard();
        };
    }

    function updateSummaryCards() {
        const monthTransactions = transactions.filter(t => 
            new Date(t.date).toLocaleString('default', { month: 'long', year: 'numeric' }) === currentMonth
        );

        const income = monthTransactions.filter(t => t.type === 'income')
            .reduce((sum, t) => sum + parseCurrency(t.amount), 0);
        
        const expenses = monthTransactions.filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + parseCurrency(t.amount), 0);
        
        const savings = income - expenses;

        document.getElementById('totalIncome').textContent = formatCurrency(income);
        document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
        document.getElementById('netAmount').textContent = formatCurrency(savings);
    }

    function renderRecentTransactions() {
        const container = document.getElementById('recentTransactionsList');
        container.innerHTML = '';

        const recent = transactions
            .filter(t => new Date(t.date).toLocaleString('default', { month: 'long', year: 'numeric' }) === currentMonth)
            .slice(-5)
            .reverse();

        if (recent.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: #6b7280; padding: 2rem;">
                    <i class="fas fa-receipt" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <div>No transactions this month</div>
                </div>
            `;
            return;
        }

        recent.forEach(transaction => {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="font-semibold">${transaction.description}</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">${transaction.category}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${transaction.type === 'income' ? 'text-green' : 'text-red'}">
                            ${formatCurrency(parseCurrency(transaction.amount))}
                        </div>
                        <div style="color: #6b7280; font-size: 0.75rem;">${new Date(transaction.date).toLocaleDateString()}</div>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function renderCategoryProgress() {
        const container = document.getElementById('categoryProgress');
        container.innerHTML = '';

        const monthTransactions = transactions.filter(t => 
            new Date(t.date).toLocaleString('default', { month: 'long', year: 'numeric' }) === currentMonth &&
            t.type === 'expense'
        );

        const categoryTotals = {};
        monthTransactions.forEach(t => {
            categoryTotals[t.category] = (categoryTotals[t.category] || 0) + parseCurrency(t.amount);
        });

        // Get top 3 categories
        const topCategories = Object.entries(categoryTotals)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3);

        if (topCategories.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 1rem;">Start adding expenses to see progress</div>';
            return;
        }

        topCategories.forEach(([category, amount]) => {
            const categoryData = categories.find(c => c.name === category);
            const budget = categoryData ? categoryData.budget : 0;
            const percentage = budget > 0 ? Math.min((amount / budget) * 100, 100) : 0;
            
            const div = document.createElement('div');
            div.className = 'space-y-2';
            div.innerHTML = `
                <div class="flex justify-between text-sm">
                    <span class="font-semibold">${category}</span>
                    <span>${formatCurrency(amount)} / ${formatCurrency(budget)}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%"></div>
                </div>
                <div class="flex justify-between text-xs" style="color: #6b7280;">
                    <span>${percentage.toFixed(1)}% used</span>
                    <span>${formatCurrency(Math.max(0, budget - amount))} remaining</span>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // Transactions functions
    function renderTransactionsList() {
        const container = document.getElementById('transactionsList');
        container.innerHTML = '';

        const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
        const searchTerm = document.getElementById('searchTransactions').value.toLowerCase();

        const filtered = sorted.filter(t => 
            t.description.toLowerCase().includes(searchTerm) ||
            t.category.toLowerCase().includes(searchTerm) ||
            t.type.toLowerCase().includes(searchTerm)
        );

        if (filtered.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: #6b7280; padding: 3rem;">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <div>No transactions found</div>
                </div>
            `;
            return;
        }

        filtered.forEach(transaction => {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="font-semibold">${transaction.description}</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">
                            ${transaction.category} • ${new Date(transaction.date).toLocaleDateString()}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${transaction.type === 'income' ? 'text-green' : 'text-red'}">
                            ${formatCurrency(parseCurrency(transaction.amount))}
                        </div>
                        <button onclick="deleteTransaction('${transaction.id}')" 
                                style="color: #ef4444; background: none; border: none; padding: 0.5rem; cursor: pointer; margin-top: 0.5rem;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // Analytics functions
    function refreshAnalytics() {
        updateAnalyticsSummary();
        renderMonthlyBreakdown();
    }

    function updateAnalyticsSummary() {
        const range = parseInt(document.getElementById('analyticsRange').value);
        const monthlyData = getMonthlyData(range);
        
        const avgIncome = monthlyData.income.length > 0 ? 
            monthlyData.income.reduce((a, b) => a + b, 0) / monthlyData.income.length : 0;
        const avgExpenses = monthlyData.expenses.length > 0 ? 
            monthlyData.expenses.reduce((a, b) => a + b, 0) / monthlyData.expenses.length : 0;
        const avgSavings = monthlyData.savings.length > 0 ? 
            monthlyData.savings.reduce((a, b) => a + b, 0) / monthlyData.savings.length : 0;

        document.getElementById('avgIncome').textContent = formatCurrency(avgIncome);
        document.getElementById('avgExpenses').textContent = formatCurrency(avgExpenses);
        document.getElementById('avgSavings').textContent = formatCurrency(avgSavings);
    }

    function renderMonthlyBreakdown() {
        const container = document.getElementById('monthlyBreakdown');
        container.innerHTML = '';

        const range = parseInt(document.getElementById('analyticsRange').value);
        const monthlyData = getMonthlyData(range);

        if (monthlyData.labels.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 2rem;">No data available</div>';
            return;
        }

        monthlyData.labels.forEach((month, index) => {
            const income = monthlyData.income[index];
            const expenses = monthlyData.expenses[index];
            const savings = monthlyData.savings[index];
            const savingsRate = income > 0 ? ((savings / income) * 100) : 0;

            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <div class="font-semibold">${month}</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">
                            Savings Rate: ${savingsRate >= 0 ? '+' : ''}${savingsRate.toFixed(1)}%
                        </div>
                    </div>
                    <div class="text-right">
                        <div style="color: #10b981; font-weight: 600;">+${formatCurrency(income)}</div>
                        <div style="color: #ef4444; font-weight: 600;">-${formatCurrency(expenses)}</div>
                        <div style="color: #3b82f6; font-weight: 700;">${formatCurrency(savings)}</div>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function getMonthlyData(monthCount) {
        const allMonths = [...new Set(transactions.map(t => 
            new Date(t.date).toLocaleString('default', { month: 'short', year: 'numeric' })
        ))].sort((a, b) => new Date('1 ' + a) - new Date('1 ' + b));
        
        const recentMonths = monthCount === 'all' ? allMonths : allMonths.slice(-monthCount);
        
        const income = recentMonths.map(month => 
            transactions.filter(t => 
                new Date(t.date).toLocaleString('default', { month: 'short', year: 'numeric' }) === month &&
                t.type === 'income'
            ).reduce((sum, t) => sum + parseCurrency(t.amount), 0)
        );
        
        const expenses = recentMonths.map(month => 
            transactions.filter(t => 
                new Date(t.date).toLocaleString('default', { month: 'short', year: 'numeric' }) === month &&
                t.type === 'expense'
            ).reduce((sum, t) => sum + parseCurrency(t.amount), 0)
        );
        
        const savings = income.map((inc, i) => inc - expenses[i]);
        
        return {
            labels: recentMonths,
            income: income,
            expenses: expenses,
            savings: savings
        };
    }

    // Settings functions
    function renderSettings() {
        renderCategoriesList();
    }

    function renderCategoriesList() {
        const container = document.getElementById('categoriesList');
        container.innerHTML = '';

        if (categories.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 1rem;">No categories yet</div>';
            return;
        }

        categories.forEach(category => {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold">${category.name}</div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Budget: ${formatCurrency(category.budget)}</div>
                    </div>
                    <button onclick="deleteCategory('${category.name}')" 
                            style="color: #ef4444; background: none; border: none; padding: 0.5rem; cursor: pointer;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // Modal functions
    function showTransactionModal() {
        document.getElementById('transactionModal').classList.remove('hidden');
        document.getElementById('transDate').valueAsDate = new Date();
        document.getElementById('transDesc').value = '';
        document.getElementById('transAmount').value = '';
        currentTransactionType = '';
        updateCategoryDropdown();
    }

    function closeModal() {
        document.getElementById('transactionModal').classList.add('hidden');
    }

    function setTransactionType(type) {
        currentTransactionType = type;
        updateCategoryDropdown();
    }

    function updateCategoryDropdown() {
        const select = document.getElementById('transCategory');
        select.innerHTML = '';
        
        if (!currentTransactionType) {
            select.innerHTML = '<option value="">Select a type first</option>';
            return;
        }

        const filteredCategories = categories.filter(cat => {
            if (currentTransactionType === 'income') {
                return ['Paycheck', 'Savings', 'Loan Returned', 'Committee Taken'].includes(cat.name);
            } else {
                return !['Paycheck', 'Savings', 'Loan Returned', 'Committee Taken'].includes(cat.name);
            }
        });

        filteredCategories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.name;
            option.textContent = cat.name;
            select.appendChild(option);
        });
    }

    function saveTransaction() {
        const date = document.getElementById('transDate').value;
        const description = document.getElementById('transDesc').value.trim();
        const category = document.getElementById('transCategory').value;
        const amount = document.getElementById('transAmount').value;

        if (!date || !description || !currentTransactionType || !category || !amount) {
            alert('Please fill in all fields');
            return;
        }

        const transaction = {
            id: Date.now().toString(),
            date: date,
            description: description,
            type: currentTransactionType,
            category: category,
            amount: amount
        };

        transactions.push(transaction);
        localStorage.setItem('financeTransactions', JSON.stringify(transactions));
        
        closeModal();
        refreshDashboard();
        switchTab('dashboard');
    }

    function deleteTransaction(id) {
        if (confirm('Are you sure you want to delete this transaction?')) {
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('financeTransactions', JSON.stringify(transactions));
            renderTransactionsList();
            refreshDashboard();
        }
    }

    function showAddCategoryModal() {
        document.getElementById('addCategoryModal').classList.remove('hidden');
        document.getElementById('newCategoryName').value = '';
        document.getElementById('newCategoryBudget').value = '';
    }

    function closeCategoryModal() {
        document.getElementById('addCategoryModal').classList.add('hidden');
    }

    function saveNewCategory() {
        const name = document.getElementById('newCategoryName').value.trim();
        const budget = document.getElementById('newCategoryBudget').value;

        if (!name) {
            alert('Please enter a category name');
            return;
        }

        if (categories.some(cat => cat.name === name)) {
            alert('Category already exists');
            return;
        }

        categories.push({
            name: name,
            budget: parseCurrency(budget)
        });

        localStorage.setItem('categories', JSON.stringify(categories));
        closeCategoryModal();
        renderSettings();
    }

    function deleteCategory(name) {
        if (confirm(`Are you sure you want to delete the "${name}" category?`)) {
            categories = categories.filter(cat => cat.name !== name);
            localStorage.setItem('categories', JSON.stringify(categories));
            renderSettings();
        }
    }

    // Data management functions
    function exportData() {
        const csv = transactions.map(t => 
            `${t.date},${t.description},${t.type},${t.category},${t.amount}`
        ).join('\n');
        
        const blob = new Blob(['Date,Description,Type,Category,Amount\n' + csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `wealth-command-export-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
    }

    function backupData() {
        const backup = {
            transactions: transactions,
            categories: categories,
            backupDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `wealth-command-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
    }

    function resetAllData() {
        if (confirm('Are you sure you want to reset ALL data? This cannot be undone!')) {
            localStorage.removeItem('financeTransactions');
            localStorage.removeItem('categories');
            transactions = [];
            categories = defaultCategories.map(name => ({ name, budget: 10000 }));
            refreshDashboard();
            switchTab('dashboard');
            alert('All data has been reset');
        }
    }

    // Event listeners for buttons
    document.addEventListener('DOMContentLoaded', function() {
        // Add transaction button
        document.getElementById('addTransactionBtn').addEventListener('click', showTransactionModal);
        
        // Transaction type buttons
        document.getElementById('incomeTypeBtn').addEventListener('click', function() {
            setTransactionType('income');
        });
        
        document.getElementById('expenseTypeBtn').addEventListener('click', function() {
            setTransactionType('expense');
        });
        
        // Save transaction button
        document.getElementById('saveTransactionBtn').addEventListener('click', saveTransaction);
        
        // Close modal buttons
        document.querySelector('#transactionModal button[onclick="closeModal()"]').addEventListener('click', closeModal);
        document.querySelector('#addCategoryModal button[onclick="closeCategoryModal()"]').addEventListener('click', closeCategoryModal);
        
        // Search functionality
        document.getElementById('searchTransactions').addEventListener('input', renderTransactionsList);
        document.getElementById('analyticsRange').addEventListener('change', refreshAnalytics);
        
        // Initialize the app
        refreshDashboard();
        renderSettings();

            // ===== OFFLINE SUPPORT & PWA FUNCTIONALITY =====
    
   // Service Worker Registration with correct path
function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')  // ← Fixed path
            .then((registration) => {
                console.log('SW registered successfully at scope:', registration.scope);
                
                // Check if page is controlled by SW
                if (navigator.serviceWorker.controller) {
                    console.log('Page is controlled by Service Worker');
                }
            })
            .catch((error) => {
                console.log('SW registration failed:', error);
            });
    }
}

    // Offline/Online detection
    function updateOnlineStatus() {
        const status = navigator.onLine ? 'online' : 'offline';
        document.body.setAttribute('data-connection', status);
        
        if (status === 'online') {
            showNotification('Connection restored', 'success');
            // Sync any pending transactions
            syncPendingTransactions();
        } else {
            showNotification('You are offline - changes will save locally', 'warning');
        }
    }

    // Sync pending transactions when back online
    function syncPendingTransactions() {
        const pending = JSON.parse(localStorage.getItem('pendingTransactions') || '[]');
        if (pending.length > 0) {
            showNotification(`Syncing ${pending.length} pending transactions`, 'info');
            // Here you would send transactions to your server
            localStorage.removeItem('pendingTransactions');
        }
    }

    // Store transaction as pending if offline
    function saveTransactionWithOfflineSupport(transaction) {
        if (!navigator.onLine) {
            const pending = JSON.parse(localStorage.getItem('pendingTransactions') || '[]');
            pending.push({...transaction, pending: true, timestamp: Date.now()});
            localStorage.setItem('pendingTransactions', JSON.stringify(pending));
            showNotification('Transaction saved offline - will sync when online', 'info');
        }
        
        // Always save to local storage
        transactions.push(transaction);
        localStorage.setItem('financeTransactions', JSON.stringify(transactions));
    }

    // Enhanced notification system
    function showNotification(message, type = 'info') {
        // Remove existing notifications
        const existingNotifications = document.querySelectorAll('.connection-notification');
        existingNotifications.forEach(notif => notif.remove());
        
        const colors = {
            success: '#10b981',
            warning: '#f59e0b',
            error: '#ef4444',
            info: '#3b82f6'
        };
        
        const notification = document.createElement('div');
        notification.className = 'connection-notification';
        notification.innerHTML = `
            <div style="
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                background: ${colors[type] || colors.info};
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 300px;
            ">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${type === 'success' ? 'fa-check' : type === 'warning' ? 'fa-exclamation-triangle' : type === 'error' ? 'fa-times' : 'fa-info'}"></i>
                    <span>${message}</span>
                </div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }
        }, 4000);
    }

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        [data-connection="offline"]::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #f59e0b;
            z-index: 10001;
        }
    `;
    document.head.appendChild(style);

    // Event listeners for connectivity changes
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Initial status check
    updateOnlineStatus();

    // Install prompt for PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install button (you can add this to your UI)
        const installButton = document.createElement('button');
        installButton.innerHTML = '<i class="fas fa-download"></i> Install App';
        installButton.style.cssText = `
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            z-index: 1000;
        `;
        installButton.onclick = () => {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted install');
                }
                deferredPrompt = null;
                installButton.remove();
            });
        };
        
        // Auto-remove after 10 seconds
        setTimeout(() => installButton.remove(), 10000);
    });

   // Main JavaScript - GitHub Pages specific
function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
        // Get the correct path for GitHub Pages
        const swPath = '/service-worker.js';
        
        console.log('Registering Service Worker at:', swPath);
        
        navigator.serviceWorker.register(swPath)
            .then((registration) => {
                console.log('✅ Service Worker registered successfully');
                console.log('Scope:', registration.scope);
                
                // Force the Service Worker to take control immediately
                if (registration.waiting) {
                    registration.waiting.postMessage('skipWaiting');
                }
                if (registration.active) {
                    registration.active.postMessage('skipWaiting');
                }
                
                // Check every second if the page is controlled
                const checkControlInterval = setInterval(() => {
                    if (navigator.serviceWorker.controller) {
                        console.log('✅ Page is now controlled by Service Worker');
                        clearInterval(checkControlInterval);
                        testOfflineCapability();
                    }
                }, 1000);
                
                // Timeout after 10 seconds
                setTimeout(() => {
                    clearInterval(checkControlInterval);
                    if (!navigator.serviceWorker.controller) {
                        console.log('⚠️ Page not controlled by Service Worker after 10s');
                    }
                }, 10000);
                
            })
            .catch((error) => {
                console.log('❌ Service Worker registration failed:', error);
            });
    } else {
        console.log('❌ Service Workers not supported');
    }
}

function testOfflineCapability() {
    console.log('Testing offline capability...');
    
    // Test if the page can be loaded offline
    if ('caches' in window) {
        caches.open('wealth-command-github-v1').then(cache => {
            cache.match('.').then(response => {
                if (response) {
                    console.log('✅ Root page is cached and available offline');
                } else {
                    console.log('❌ Root page is NOT cached');
                }
            });
            
            cache.match('index.html').then(response => {
                if (response) {
                    console.log('✅ index.html is cached and available offline');
                } else {
                    console.log('❌ index.html is NOT cached');
                }
            });
        });
    }
}

// Enhanced offline detection
function updateOnlineStatus() {
    const isOnline = navigator.onLine;
    console.log('Connection status:', isOnline ? 'Online' : 'Offline');
    
    if (isOnline) {
        showNotification('Connection restored', 'success');
    } else {
        showNotification('Offline - Using local data', 'warning');
        // Ensure we're using cached data
        if (navigator.serviceWorker.controller) {
            console.log('✅ Service Worker is handling offline mode');
        } else {
            console.log('❌ No Service Worker control in offline mode');
        }
    }
}

// Force Service Worker to take control
function forceSWControl() {
    if (navigator.serviceWorker.controller) {
        console.log('Page is already controlled by Service Worker');
        return;
    }
    
    navigator.serviceWorker.getRegistration().then(registration => {
        if (registration) {
            registration.unregister().then(() => {
                console.log('Unregistered old Service Worker, reloading...');
                setTimeout(() => location.reload(), 1000);
            });
        }
    });
}

// Initialize app with Service Worker support
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing Wealth Command Pro...');
    
    // Register Service Worker first
    registerServiceWorker();
    
    // Then initialize the app
    setTimeout(() => {
        // Load data
        const stored = localStorage.getItem('financeTransactions');
        if (stored) {
            transactions = JSON.parse(stored);
        }
        
        refreshDashboard();
        renderSettings();
        
        // Set up event listeners
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Initial status
        updateOnlineStatus();
        
        console.log('App initialized. Try:');
        console.log('1. Wait for Service Worker to activate');
        console.log('2. Go offline in DevTools (Network tab)');
        console.log('3. Reload the page');
        
    }, 500);
});

// Add a manual test function you can run from console
window.testOffline = function() {
    console.log('=== OFFLINE TEST ===');
    console.log('Service Worker controlled:', !!navigator.serviceWorker.controller);
    console.log('Online status:', navigator.onLine);
    console.log('Caches supported:', 'caches' in window);
    
    if ('caches' in window) {
        caches.open('wealth-command-github-v1').then(cache => {
            return cache.keys().then(requests => {
                console.log('Cached URLs:');
                requests.forEach(request => {
                    console.log(' -', request.url);
                });
            });
        });
    }
});
</script>
</body>
</html>
